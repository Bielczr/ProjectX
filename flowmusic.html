<!DOCTYPE html>
<html lang="pt-BR" x-data="{ darkMode: false, configModal: false, activeTab: 'mapeamento' }" :class="{ 'dark': darkMode }">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowMusic Pro - Consolidador Musical Inteligente</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#14b8a6',
              600: '#0d9488',
            },
            secondary: {
              500: '#3b82f6',
              600: '#2563eb',
            },
            accent: {
              500: '#8b5cf6',
              600: '#7c3aed',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .dark .glass-card {
      background: rgba(0, 0, 0, 0.2);
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    @keyframes bubble {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.1); }
    }

    @keyframes textWave {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    @keyframes pulse-slow {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(1.02); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .animate-float { animation: float 4s ease-in-out infinite; }
    .animate-float-delay { animation: float 4s ease-in-out infinite 0.5s; }
    .animate-float-delay-2 { animation: float 4s ease-in-out infinite 1s; }
    .animate-bubble { animation: bubble 6s ease-in-out infinite; }
    .animate-bubble-delay { animation: bubble 6s ease-in-out infinite 1s; }
    .animate-bubble-delay-2 { animation: bubble 6s ease-in-out infinite 2s; }
    .animate-text-wave { animation: textWave 3s ease-in-out infinite; }
    .animate-pulse-slow { animation: pulse-slow 3s ease-in-out infinite; }
    .animate-slide-in { animation: slideIn 0.5s ease-out; }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }

    .glass-menu {
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    .dark .glass-menu {
      background: rgba(15, 23, 42, 0.7);
    }

    /* Modal de configurações moderno */
    .config-modal {
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .tab-button {
      position: relative;
      overflow: hidden;
    }

    .tab-button::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, #14b8a6, #3b82f6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .tab-button.active::before {
      transform: scaleX(1);
    }

    /* Estilos para a tabela de resultados - Responsividade fixa */
    #resultadoContainer {
      width: 100%;
      max-width: 83vw;
      overflow: hidden;
    }

    .resultado-wrapper {
      width: 100%;
      max-height: 83vh;
      overflow: auto;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }

    .dark .resultado-wrapper {
      border-color: #374151;
    }

    #resultadoPreview {
      width: 100%;
      min-width: max-content;
    }

    #resultadoPreview table {
      width: 100%;
      table-layout: auto;
      border-collapse: collapse;
    }

    #resultadoPreview th {
      position: sticky;
      top: 0;
      background-color: #f3f4f6;
      z-index: 10;
      padding: 8px;
      border: 1px solid #d1d5db;
      font-weight: 600;
      text-align: left;
      white-space: nowrap;
    }

    .dark #resultadoPreview th {
      background-color: #374151;
      border-color: #4b5563;
      color: white;
    }

    #resultadoPreview td {
      padding: 8px;
      border: 1px solid #d1d5db;
      white-space: nowrap;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .dark #resultadoPreview td {
      border-color: #4b5563;
    }

    /* Estilização da scrollbar */
    .resultado-wrapper::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .resultado-wrapper::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .resultado-wrapper::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .dark .resultado-wrapper::-webkit-scrollbar-track {
      background: #374151;
    }

    .dark .resultado-wrapper::-webkit-scrollbar-thumb {
      background: #6b7280;
    }

    /* Efeito ripple */
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    
    .ripple-effect {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      transform: scale(0);
      animation: ripple 600ms linear;
      pointer-events: none;
    }

    /* Melhor contraste para dark mode */
    .dark .bg-gray-800-opacity {
      background-color: rgba(31, 41, 55, 0.8);
    }
  </style>
</head>

<body class="bg-gradient-to-br from-teal-50 via-blue-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 min-h-screen font-sans">
  <!-- Layout Principal -->
  <div class="flex flex-col lg:flex-row min-h-screen relative z-10">

    <!-- Menu Lateral Fixo Moderno com Animação -->
    <div class="glass-menu w-full lg:w-72 h-auto lg:h-screen p-6 lg:sticky lg:top-0 transition-all duration-300 overflow-hidden">
      <!-- Cabeçalho do Menu com Animação -->
      <div class="mb-8 flex items-center justify-between relative">
        <div class="relative">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-teal-500 to-blue-600 bg-clip-text text-transparent tracking-tight">
            Ferramentas Inteligentes
          </h3>
          <div class="absolute -bottom-1 left-0 h-0.5 bg-gradient-to-r from-teal-500 to-blue-600 rounded-full w-full animate-pulse"></div>
        </div>
        <div class="hidden lg:block p-2 rounded-full bg-white/10 backdrop-blur-sm hover:rotate-90 transition-transform duration-500">
          <svg class="w-5 h-5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </div>
      </div>

      <!-- Itens do Menu -->
      <div class="space-y-3">
        <!-- Item 1 - PercentSplit -->
        <a href="#" class="menu-item group block px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/5 hover:shadow-lg hover:shadow-blue-500/10 relative overflow-hidden">
          <div class="absolute inset-0 bg-blue-500 opacity-0 group-hover:opacity-10 transition-opacity duration-500"></div>
          <div class="flex items-center gap-4 relative z-10">
            <div class="p-3 rounded-xl bg-blue-100 dark:bg-blue-900/50 group-hover:bg-blue-200 dark:group-hover:bg-blue-800 transition-all duration-300 animate-float">
              <svg class="w-6 h-6 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                </path>
              </svg>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800 dark:text-gray-100 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors duration-300">PercentSplit</h4>
              <p class="text-sm text-gray-600 dark:text-gray-300">Calculadora de percentuais avançada</p>
            </div>
            <svg class="w-5 h-5 text-gray-400 opacity-0 group-hover:opacity-100 transform -translate-x-1 group-hover:translate-x-0 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </div>
        </a>

        <!-- Item 2 - Financeret -->
        <a href="#" class="menu-item group block px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/5 hover:shadow-lg hover:shadow-purple-500/10 relative overflow-hidden">
          <div class="absolute inset-0 bg-purple-500 opacity-0 group-hover:opacity-10 transition-opacity duration-500"></div>
          <div class="flex items-center gap-4 relative z-10">
            <div class="p-3 rounded-xl bg-purple-100 dark:bg-purple-900/50 group-hover:bg-purple-200 dark:group-hover:bg-purple-800 transition-all duration-300 animate-float-delay">
              <svg class="w-6 h-6 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                </path>
              </svg>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800 dark:text-gray-100 group-hover:text-purple-500 dark:group-hover:text-purple-400 transition-colors duration-300">Financeret</h4>
              <p class="text-sm text-gray-600 dark:text-gray-300">Gestão de retidos e duplicidades</p>
            </div>
            <svg class="w-5 h-5 text-gray-400 opacity-0 group-hover:opacity-100 transform -translate-x-1 group-hover:translate-x-0 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </div>
        </a>

        <!-- Item 3 - FlowMusic (Ativo) -->
        <div class="menu-item group block px-4 py-3 rounded-xl transition-all duration-300 bg-gradient-to-r from-teal-500/10 to-green-500/10 border border-teal-500/20 relative overflow-hidden">
          <div class="absolute inset-0 bg-teal-500 opacity-10"></div>
          <div class="flex items-center gap-4 relative z-10">
            <div class="p-3 rounded-xl bg-teal-100 dark:bg-teal-900/50 transition-all duration-300 animate-float-delay-2">
              <svg class="w-6 h-6 text-teal-500 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                </path>
              </svg>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-teal-600 dark:text-teal-400">FlowMusic</h4>
              <p class="text-sm text-teal-600/80 dark:text-teal-300">Consolidador musical inteligente</p>
            </div>
            <div class="w-2 h-2 rounded-full bg-teal-500 animate-pulse"></div>
          </div>
        </div>
      </div>

      <!-- Elemento Animado Inferior -->
      <div class="mt-8 pt-6 border-t border-white/10 relative">
        <!-- Bolhas flutuantes -->
        <div class="absolute -bottom-2 -left-2 w-4 h-4 rounded-full bg-teal-400 opacity-20 animate-bubble"></div>
        <div class="absolute -bottom-4 left-8 w-3 h-3 rounded-full bg-purple-400 opacity-20 animate-bubble-delay"></div>
        <div class="absolute -bottom-3 right-4 w-5 h-5 rounded-full bg-green-400 opacity-20 animate-bubble-delay-2"></div>
        
        <!-- Texto animado -->
        <div class="flex items-center justify-center gap-2 text-sm text-gray-500 dark:text-gray-400">
          <span class="animate-pulse">✨</span>
          <span class="animate-text-wave">By Gabriel Cesar</span>
          <span class="animate-pulse delay-300">✨</span>
        </div>
      </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="flex-1 p-8">
      <!-- Header Modernizado -->
      <header class="flex justify-between items-center mb-12 px-6 py-4 rounded-2xl bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-lg border border-white/20 dark:border-gray-700/50">
        <!-- Logo Redesenhada -->
        <div class="flex items-center gap-4">
          <div class="relative">
            <!-- Símbolo da logo com gradiente -->
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-400 via-blue-500 to-purple-500 flex items-center justify-center shadow-lg relative overflow-hidden">
              <!-- Ícone musical -->
              <svg class="w-7 h-7 text-white z-10" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
              </svg>
              <!-- Efeito de brilho animado -->
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 animate-pulse-slow"></div>
            </div>
            <!-- Efeito de brilho externo -->
            <div class="absolute -inset-1 rounded-xl bg-gradient-to-r from-teal-400 to-purple-500 opacity-30 blur-md animate-pulse-slow"></div>
          </div>
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-teal-500 via-blue-600 to-purple-600 bg-clip-text text-transparent tracking-tight">
              Flow<span class="font-extrabold">Music</span>
            </h1>
            <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Consolidador Musical Inteligente</p>
          </div>
        </div>

        <!-- Grupo de Ações Modernizado -->
        <div class="flex items-center gap-3">
          <!-- Botão de Tutorial -->
          <button class="p-3 rounded-xl bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 hover:from-blue-200 hover:to-purple-200 dark:hover:from-blue-800/50 dark:hover:to-purple-800/50 transition-all duration-300 group relative"
            title="Tutorial Interativo">
            <svg class="w-6 h-6 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="absolute inset-0 border-2 border-blue-400/0 group-hover:border-blue-400/30 rounded-xl transition-all duration-300 pointer-events-none"></div>
          </button>

          <!-- Botão de Configurações Modernizado -->
          <button @click="configModal = true" 
            class="p-3 rounded-xl bg-gradient-to-r from-teal-100 to-green-100 dark:from-teal-900/30 dark:to-green-900/30 hover:from-teal-200 hover:to-green-200 dark:hover:from-teal-800/50 dark:hover:to-green-800/50 transition-all duration-300 group relative"
            title="Configurações Avançadas">
            <svg class="w-6 h-6 text-teal-600 dark:text-teal-400 group-hover:rotate-90 transition-transform duration-500" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
            </svg>
            <div class="absolute inset-0 border-2 border-teal-400/0 group-hover:border-teal-400/30 rounded-xl transition-all duration-300 pointer-events-none"></div>
          </button>

          <!-- Botão de Tema Modernizado -->
          <button @click="darkMode = !darkMode"
            class="p-3 rounded-xl bg-gradient-to-r from-amber-100 to-orange-100 dark:from-blue-900/30 dark:to-indigo-900/30 hover:from-amber-200 hover:to-orange-200 dark:hover:from-blue-800/50 dark:hover:to-indigo-800/50 transition-all duration-300 group relative"
            title="Alternar Tema">
            <!-- Ícone de sol -->
            <svg x-show="!darkMode" class="w-6 h-6 text-amber-600 group-hover:rotate-12 transition-transform duration-500" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,18C8.69,18 6,15.31 6,12C6,8.69 8.69,6 12,6C15.31,6 18,8.69 18,12C18,15.31 15.31,18 12,18M12,8C9.79,8 8,9.79 8,12C8,14.21 9.79,16 12,16C14.21,16 16,14.21 16,12C16,9.79 14.21,8 12,8M12,4C11,4 10,4.2 9.06,4.56C8.73,4.69 8.61,5.09 8.83,5.37C9.05,5.64 9.45,5.75 9.73,5.53C10.5,5.06 11.25,4.85 12,4.85C12.75,4.85 13.5,5.06 14.27,5.53C14.55,5.75 14.95,5.64 15.17,5.37C15.39,5.09 15.27,4.69 14.94,4.56C14,4.2 13,4 12,4M12,19.15C11.25,19.15 10.5,18.94 9.73,18.47C9.45,18.25 9.05,18.36 8.83,18.63C8.61,18.91 8.73,19.31 9.06,19.44C10,19.8 11,20 12,20C13,20 14,19.8 14.94,19.44C15.27,19.31 15.39,18.91 15.17,18.63C14.95,18.36 14.55,18.25 14.27,18.47C13.5,18.94 12.75,19.15 12,19.15M5,12C5,11.25 5.21,10.5 5.68,9.73C5.9,9.45 5.79,9.05 5.5,8.83C5.23,8.61 4.83,8.73 4.7,9.06C4.34,10 4.15,11 4.15,12C4.15,13 4.34,14 4.7,14.94C4.83,15.27 5.23,15.39 5.5,15.17C5.79,14.95 5.9,14.55 5.68,14.27C5.21,13.5 5,12.75 5,12M19.32,14.27C19.1,14.55 19.21,14.95 19.5,15.17C19.77,15.39 20.17,15.27 20.3,14.94C20.66,14 20.85,13 20.85,12C20.85,11 20.66,10 20.3,9.06C20.17,8.73 19.77,8.61 19.5,8.83C19.21,9.05 19.1,9.45 19.32,9.73C19.79,10.5 20,11.25 20,12C20,12.75 19.79,13.5 19.32,14.27Z" />
            </svg>
            <!-- Ícone de lua -->
            <svg x-show="darkMode" class="w-6 h-6 text-blue-400 group-hover:scale-110 transition-transform duration-300" viewBox="0 0 24 24">
              <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.4 6.35,17.41C9.37,20.43 14,20.54 17.33,17.97Z" />
            </svg>
            <div class="absolute inset-0 border-2 border-amber-400/0 group-hover:border-amber-400/30 dark:group-hover:border-blue-400/30 rounded-xl transition-all duration-300 pointer-events-none"></div>
          </button>
        </div>
      </header>

      <!-- Main Card Modernizado -->
      <div class="glass-card rounded-3xl shadow-2xl overflow-hidden transition-all duration-300 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-white/20 dark:border-gray-700/50 animate-slide-in">
        <div class="p-10">
          <!-- Upload Sections - Design Completamente Atualizado -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            <!-- ROL DE OBRAS -->
            <div 
              class="border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-3xl p-8 text-center cursor-pointer transition-all duration-500 h-full flex flex-col items-center justify-center hover:border-teal-400 hover:bg-gradient-to-br hover:from-teal-50/50 hover:to-blue-50/50 dark:hover:from-teal-900/10 dark:hover:to-blue-900/10 relative group overflow-hidden transform hover:scale-105"
              @click="document.getElementById('rolObras').click()">
              <!-- Efeito de fundo animado -->
              <div class="absolute inset-0 bg-gradient-to-br from-teal-400/0 via-blue-400/0 to-purple-400/0 group-hover:from-teal-400/5 group-hover:via-blue-400/5 group-hover:to-purple-400/5 transition-all duration-700"></div>
              <!-- Partículas flutuantes -->
              <div class="absolute top-4 left-4 w-2 h-2 rounded-full bg-teal-400 opacity-0 group-hover:opacity-30 animate-bounce transition-opacity duration-500"></div>
              <div class="absolute top-8 right-6 w-1 h-1 rounded-full bg-blue-400 opacity-0 group-hover:opacity-40 animate-pulse transition-opacity duration-700"></div>
              <div class="absolute bottom-6 left-8 w-1.5 h-1.5 rounded-full bg-purple-400 opacity-0 group-hover:opacity-35 animate-ping transition-opacity duration-600"></div>
              
              <!-- Conteúdo principal -->
              <div class="relative z-10">
                <div class="w-16 h-16 bg-gradient-to-br from-teal-100 to-blue-100 dark:from-teal-900/30 dark:to-blue-900/30 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:rotate-3 transition-all duration-500 shadow-lg">
                  <svg class="w-9 h-9 text-teal-500 dark:text-teal-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                </div>
                <h3 class="font-bold text-xl mb-3 text-gray-800 dark:text-gray-100 group-hover:text-teal-600 dark:group-hover:text-teal-400 transition-colors duration-300">ROL DE OBRAS</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 leading-relaxed" id="rolObrasFileName">Nenhum arquivo selecionado</p>
                <div class="mt-4 px-4 py-2 bg-teal-100 dark:bg-teal-900/30 rounded-full text-xs text-teal-600 dark:text-teal-400 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                  📊 Clique para selecionar
                </div>
              </div>
              <input type="file" id="rolObras" class="hidden" accept=".xlsx, .xls, .csv">
            </div>

            <!-- FICHA TÉCNICA -->
            <div 
              class="border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-3xl p-8 text-center cursor-pointer transition-all duration-500 h-full flex flex-col items-center justify-center hover:border-blue-400 hover:bg-gradient-to-br hover:from-blue-50/50 hover:to-purple-50/50 dark:hover:from-blue-900/10 dark:hover:to-purple-900/10 relative group overflow-hidden transform hover:scale-105"
              @click="document.getElementById('fichaTecnica').click()">
              <div class="absolute inset-0 bg-gradient-to-br from-blue-400/0 via-purple-400/0 to-pink-400/0 group-hover:from-blue-400/5 group-hover:via-purple-400/5 group-hover:to-pink-400/5 transition-all duration-700"></div>
              <div class="absolute top-6 right-4 w-2 h-2 rounded-full bg-blue-400 opacity-0 group-hover:opacity-30 animate-bounce transition-opacity duration-500 delay-100"></div>
              <div class="absolute bottom-4 right-8 w-1 h-1 rounded-full bg-purple-400 opacity-0 group-hover:opacity-40 animate-pulse transition-opacity duration-700 delay-200"></div>
              <div class="absolute top-8 left-6 w-1.5 h-1.5 rounded-full bg-pink-400 opacity-0 group-hover:opacity-35 animate-ping transition-opacity duration-600 delay-150"></div>
              
              <div class="relative z-10">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:-rotate-3 transition-all duration-500 shadow-lg">
                  <svg class="w-9 h-9 text-blue-500 dark:text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                </div>
                <h3 class="font-bold text-xl mb-3 text-gray-800 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300">FICHA TÉCNICA</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 leading-relaxed" id="fichaTecnicaFileName">Nenhum arquivo selecionado</p>
                <div class="mt-4 px-4 py-2 bg-blue-100 dark:bg-blue-900/30 rounded-full text-xs text-blue-600 dark:text-blue-400 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                  🎵 Clique para selecionar
                </div>
              </div>
              <input type="file" id="fichaTecnica" class="hidden" accept=".xlsx, .xls, .csv">
            </div>

            <!-- DADOS DO TITULAR -->
            <div 
              class="border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-3xl p-8 text-center cursor-pointer transition-all duration-500 h-full flex flex-col items-center justify-center hover:border-purple-400 hover:bg-gradient-to-br hover:from-purple-50/50 hover:to-pink-50/50 dark:hover:from-purple-900/10 dark:hover:to-pink-900/10 relative group overflow-hidden transform hover:scale-105"
              @click="document.getElementById('dadosTitular').click()">
              <div class="absolute inset-0 bg-gradient-to-br from-purple-400/0 via-pink-400/0 to-rose-400/0 group-hover:from-purple-400/5 group-hover:via-pink-400/5 group-hover:to-rose-400/5 transition-all duration-700"></div>
              <div class="absolute top-4 right-6 w-2 h-2 rounded-full bg-purple-400 opacity-0 group-hover:opacity-30 animate-bounce transition-opacity duration-500 delay-200"></div>
              <div class="absolute bottom-8 left-4 w-1 h-1 rounded-full bg-pink-400 opacity-0 group-hover:opacity-40 animate-pulse transition-opacity duration-700 delay-100"></div>
              <div class="absolute top-6 left-8 w-1.5 h-1.5 rounded-full bg-rose-400 opacity-0 group-hover:opacity-35 animate-ping transition-opacity duration-600 delay-300"></div>
              
              <div class="relative z-10">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:rotate-6 transition-all duration-500 shadow-lg">
                  <svg class="w-9 h-9 text-purple-500 dark:text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <h3 class="font-bold text-xl mb-3 text-gray-800 dark:text-gray-100 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors duration-300">DADOS TITULAR</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 leading-relaxed" id="dadosTitularFileName">Nenhum arquivo selecionado</p>
                <div class="mt-4 px-4 py-2 bg-purple-100 dark:bg-purple-900/30 rounded-full text-xs text-purple-600 dark:text-purple-400 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                  👤 Clique para selecionar
                </div>
              </div>
              <input type="file" id="dadosTitular" class="hidden" accept=".xlsx, .xls, .csv">
            </div>
          </div>

          <!-- Botão de Processar Completamente Redesenhado -->
          <div class="text-center">
            <button id="processarBtn" onclick="app.processarPlanilhas()"
              class="relative bg-gradient-to-r from-teal-500 via-blue-500 to-purple-500 hover:from-teal-600 hover:via-blue-600 hover:to-purple-600 text-white font-bold py-5 px-12 rounded-2xl shadow-2xl hover:shadow-3xl transition-all duration-500 inline-flex items-center gap-4 overflow-hidden group transform hover:scale-105">
              <!-- Efeito de brilho animado -->
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 group-hover:animate-pulse"></div>
              <!-- Conteúdo do botão -->
              <span class="relative z-10 flex items-center gap-3">
                <svg id="processarIcon" class="w-7 h-7 group-hover:rotate-12 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
                <span id="processarText" class="text-xl font-bold tracking-wide">Processar Planilhas</span>
              </span>
              <!-- Ícone de loading -->
              <svg id="loadingIcon" class="absolute left-1/2 -ml-14 h-6 w-6 text-white hidden animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <!-- Partículas de fundo -->
              <div class="absolute top-2 left-4 w-1 h-1 rounded-full bg-white/30 animate-ping"></div>
              <div class="absolute bottom-3 right-6 w-1.5 h-1.5 rounded-full bg-white/20 animate-pulse"></div>
            </button>
          </div>
        </div>
      </div>

      <!-- Resultado Modernizado -->
      <div id="resultadoContainer" class="glass-card rounded-3xl shadow-2xl p-10 mt-10 hidden bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-white/20 dark:border-gray-700/50 animate-slide-in">
        <div class="flex justify-between items-center mb-8">
          <h3 class="text-3xl font-bold flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-teal-100 dark:from-green-900/30 dark:to-teal-900/30 rounded-2xl flex items-center justify-center shadow-lg">
              <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
            <span class="bg-gradient-to-r from-green-500 via-teal-500 to-blue-500 bg-clip-text text-transparent">Planilha Consolidada Gerada!</span>
          </h3>
          <button id="downloadBtn" onclick="app.downloadPlanilha()"
            class="bg-gradient-to-r from-green-500 via-teal-500 to-blue-500 hover:from-green-600 hover:via-teal-600 hover:to-blue-600 text-white py-4 px-8 rounded-xl font-bold shadow-xl hover:shadow-2xl transition-all duration-300 flex items-center gap-3 transform hover:scale-105">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            <span class="text-lg">Baixar Planilha</span>
          </button>
        </div>

        <div class="bg-white/50 dark:bg-gray-800/50 rounded-2xl p-8 shadow-inner overflow-x-auto border border-gray-100 dark:border-gray-700" style="max-height: 60vh;">
          <div id="resultadoPreview" class="text-sm min-w-max">
            <!-- Pré-visualização será inserida aqui -->
          </div>
        </div>

        <div id="validacaoContainer" class="mt-8 p-6 bg-gradient-to-r from-amber-50/80 to-orange-50/80 dark:from-amber-900/20 dark:to-orange-900/20 rounded-2xl border border-amber-100 dark:border-amber-800/50 hidden">
          <h4 class="font-bold text-xl mb-4 flex items-center gap-3">
            <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/40 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-amber-500 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
            <span class="text-amber-600 dark:text-amber-300">Alertas de Validação</span>
          </h4>
          <div id="validacaoLista" class="text-sm text-amber-700 dark:text-amber-200 space-y-3">
            <!-- Alertas serão inseridos aqui -->
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal de Configurações Completamente Redesenhado -->
  <div x-show="configModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 config-modal animate-fade-in"
    @click.away="configModal = false">
    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden border border-white/20 dark:border-gray-700/50 animate-slide-in">
      <!-- Header do Modal -->
      <div class="bg-gradient-to-r from-teal-500 via-blue-500 to-purple-500 p-6 text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -skew-x-12 animate-pulse-slow"></div>
        <div class="flex justify-between items-center relative z-10">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
              <svg class="w-7 h-7 text-white" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
              </svg>
            </div>
            <div>
              <h3 class="text-2xl font-bold">Configurações Avançadas</h3>
              <p class="text-white/80 text-sm">Personalize o comportamento e aparência da calculadora</p>
            </div>
          </div>
          <button @click="configModal = false" class="p-2 rounded-xl bg-white/20 hover:bg-white/30 transition-colors duration-300 backdrop-blur-sm">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Navegação por Abas -->
      <div class="bg-white/50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700">
        <div class="flex overflow-x-auto">
          <button @click="activeTab = 'mapeamento'" 
            :class="activeTab === 'mapeamento' ? 'active' : ''"
            class="tab-button flex-1 px-6 py-4 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-teal-600 dark:hover:text-teal-400 transition-colors duration-300 whitespace-nowrap">
            <div class="flex items-center gap-2 justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              Mapeamento
            </div>
          </button>
          <button @click="activeTab = 'presets'" 
            :class="activeTab === 'presets' ? 'active' : ''"
            class="tab-button flex-1 px-6 py-4 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-300 whitespace-nowrap">
            <div class="flex items-center gap-2 justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
              Presets e Templates
            </div>
          </button>
          <button @click="activeTab = 'validacao'" 
            :class="activeTab === 'validacao' ? 'active' : ''"
            class="tab-button flex-1 px-6 py-4 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-300 whitespace-nowrap">
            <div class="flex items-center gap-2 justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Validação
            </div>
          </button>
          <button @click="activeTab = 'avancado'" 
            :class="activeTab === 'avancado' ? 'active' : ''"
            class="tab-button flex-1 px-6 py-4 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-green-600 dark:hover:text-green-400 transition-colors duration-300 whitespace-nowrap">
            <div class="flex items-center gap-2 justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              Avançado
            </div>
          </button>
        </div>
      </div>

      <!-- Conteúdo das Abas -->
      <div class="p-8 overflow-y-auto max-h-[60vh]">
        <!-- Aba Mapeamento -->
        <div x-show="activeTab === 'mapeamento'" class="animate-fade-in">
          <div class="mb-8">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold flex items-center gap-3">
                <div class="w-10 h-10 bg-teal-100 dark:bg-teal-900/30 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-teal-500 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                </div>
                Mapeamento de Campos
              </h3>
              <button onclick="app.adicionarCampo()"
                class="bg-gradient-to-r from-teal-500 to-blue-500 hover:from-teal-600 hover:to-blue-600 text-white py-2 px-4 rounded-xl transition-all duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Adicionar Campo
              </button>
            </div>

            <div class="bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900/20 rounded-2xl p-6 shadow-inner border border-gray-200 dark:border-gray-700">
              <div class="grid grid-cols-12 gap-3 mb-4 text-sm text-gray-600 dark:text-gray-400 font-semibold">
                <div class="col-span-5">Coluna na Planilha Final</div>
                <div class="col-span-4">Origem dos Dados</div>
                <div class="col-span-2">Coluna de Origem</div>
                <div class="col-span-1">Ações</div>
              </div>

              <div id="mapeamentoCampos" class="space-y-3">
                <!-- Campos serão adicionados dinamicamente aqui -->
              </div>
            </div>
          </div>
        </div>

        <!-- Aba Presets -->
        <div x-show="activeTab === 'presets'" class="animate-fade-in">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
            </div>
            Presets e Templates
          </h3>

          <!-- Presets de Configuração -->
          <div class="mb-8">
            <h4 class="font-semibold text-lg mb-4 text-gray-700 dark:text-gray-300">Configurações Pré-definidas</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-6 border border-purple-200 dark:border-purple-800/50 hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:scale-105"
                @click="app.carregarPreset('ecad')">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/50 rounded-xl flex items-center justify-center">
                    <svg class="w-7 h-7 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                    </svg>
                  </div>
                  <div>
                    <h5 class="font-bold text-lg text-purple-700 dark:text-purple-300">Modelo ECAD</h5>
                    <p class="text-sm text-purple-600 dark:text-purple-400">Configuração padrão para envio ao ECAD</p>
                  </div>
                </div>
                <button class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-xl transition-colors duration-300 font-medium">
                  Aplicar Preset
                </button>
              </div>

              <div class="bg-gradient-to-br from-green-50 to-teal-50 dark:from-green-900/20 dark:to-teal-900/20 rounded-2xl p-6 border border-green-200 dark:border-green-800/50 hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:scale-105"
                @click="app.carregarPreset('basico')">
                <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 bg-green-100 dark:bg-green-900/50 rounded-xl flex items-center justify-center">
                    <svg class="w-7 h-7 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                    </svg>
                  </div>
                  <div>
                    <h5 class="font-bold text-lg text-green-700 dark:text-green-300">Modelo Básico</h5>
                    <p class="text-sm text-green-600 dark:text-green-400">Apenas campos essenciais</p>
                  </div>
                </div>
                <button class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-xl transition-colors duration-300 font-medium">
                  Aplicar Preset
                </button>
              </div>
            </div>
          </div>

          <!-- Gerenciar Configurações -->
          <div>
            <h4 class="font-semibold text-lg mb-4 text-gray-700 dark:text-gray-300">Gerenciar Configurações</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button onclick="app.exportarConfiguracao()"
                class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white py-3 px-6 rounded-xl transition-all duration-300 flex items-center gap-3 justify-center shadow-lg hover:shadow-xl transform hover:scale-105">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Exportar Configuração
              </button>
              <button onclick="document.getElementById('importConfig').click()"
                class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white py-3 px-6 rounded-xl transition-all duration-300 flex items-center gap-3 justify-center shadow-lg hover:shadow-xl transform hover:scale-105">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                </svg>
                Importar Configuração
                <input type="file" id="importConfig" class="hidden" accept=".json" onchange="app.importarConfiguracao(event)">
              </button>
              <button class="bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white py-3 px-6 rounded-xl transition-all duration-300 flex items-center gap-3 justify-center shadow-lg hover:shadow-xl transform hover:scale-105">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                Salvar como Preset
              </button>
            </div>
          </div>
        </div>

        <!-- Aba Validação -->
        <div x-show="activeTab === 'validacao'" class="animate-fade-in">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            Configurações de Validação
          </h3>

          <div class="space-y-6">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 border border-blue-200 dark:border-blue-800/50">
              <h4 class="font-semibold text-lg mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Validações Básicas
              </h4>
              <div class="space-y-4">
                <label class="flex items-center space-x-4 p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl hover:bg-white/70 dark:hover:bg-gray-800/70 transition-colors duration-300 cursor-pointer">
                  <input type="checkbox" id="validarPseudonimo"
                    class="w-5 h-5 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                    checked>
                  <div class="flex-1">
                    <span class="font-medium text-gray-700 dark:text-gray-300">Validar correspondência de pseudônimos</span>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Verifica se os pseudônimos dos intérpretes existem na base de dados</p>
                  </div>
                </label>
                <label class="flex items-center space-x-4 p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl hover:bg-white/70 dark:hover:bg-gray-800/70 transition-colors duration-300 cursor-pointer">
                  <input type="checkbox" id="validarCamposObrigatorios"
                    class="w-5 h-5 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                    checked>
                  <div class="flex-1">
                    <span class="font-medium text-gray-700 dark:text-gray-300">Validar campos obrigatórios</span>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Impede o processamento se campos essenciais estiverem vazios</p>
                  </div>
                </label>
                <label class="flex items-center space-x-4 p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl hover:bg-white/70 dark:hover:bg-gray-800/70 transition-colors duration-300 cursor-pointer">
                  <input type="checkbox" id="validarRelacionamentos"
                    class="w-5 h-5 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                    checked>
                  <div class="flex-1">
                    <span class="font-medium text-gray-700 dark:text-gray-300">Validar relacionamentos entre planilhas</span>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Verifica se os dados entre as planilhas são consistentes</p>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Aba Avançado -->
        <div x-show="activeTab === 'avancado'" class="animate-fade-in">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-green-500 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
            </div>
            Configurações Avançadas
          </h3>

          <div class="space-y-6">
            <div class="bg-gradient-to-r from-green-50 to-teal-50 dark:from-green-900/20 dark:to-teal-900/20 rounded-2xl p-6 border border-green-200 dark:border-green-800/50">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Coluna de referência (ID)</label>
                  <input type="text" id="colunaId" value="TITULO"
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Campo usado para relacionar dados entre planilhas</p>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Separador de múltiplos valores</label>
                  <input type="text" id="separadorValores" value="-"
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Caractere usado para separar múltiplos valores</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer do Modal -->
      <div class="bg-gray-50 dark:bg-gray-800/50 px-8 py-6 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
        <div class="text-sm text-gray-500 dark:text-gray-400">
          Configurações salvas automaticamente
        </div>
        <div class="flex gap-3">
          <button @click="configModal = false"
            class="px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-300">
            Cancelar
          </button>
          <button @click="configModal = false"
            class="px-6 py-2 bg-gradient-to-r from-teal-500 to-blue-500 hover:from-teal-600 hover:to-blue-600 text-white rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
            Salvar e Fechar
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>

    // Adiciona um efeito de "tremor" quando o mouse entra no menu
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('mouseenter', () => {
    item.style.transform = 'translateX(4px)';
    setTimeout(() => { item.style.transform = 'translateX(0)'; }, 200);
  });
});

// Detecta se o usuário está inativo no menu e ativa animações extras
let inactivityTimer;
const menu = document.querySelector('.glass-menu');

function resetInactivityTimer() {
  clearTimeout(inactivityTimer);
  menu.classList.remove('user-inactive');
  
  inactivityTimer = setTimeout(() => {
    menu.classList.add('user-inactive'); // Adiciona classe quando o usuário não interage
  }, 3000); // 3 segundos sem interação
}

menu.addEventListener('mousemove', resetInactivityTimer);
menu.addEventListener('click', resetInactivityTimer);
resetInactivityTimer(); // Inicia o timer

    // Classe principal da aplicação
    class ConsolidadorMusical {
      constructor() {
        this.dados = {
          rolObras: null,
          fichaTecnica: null,
          dadosTitular: null
        };

        this.presets = {
          ecad: [
            { nomeFinal: "TITULO", origem: "ROL", colunaOrigem: "TITULO" },
            { nomeFinal: "NOME DOS AUTORES", origem: "ROL", colunaOrigem: "AUTOR" },
            { nomeFinal: "PORCENTAGEM DOS AUTORES", origem: "ROL", colunaOrigem: "%" },
            { nomeFinal: "CPF DOS AUTORES", origem: "ROL", colunaOrigem: "AUTOR" },
            { nomeFinal: "NOME DA EDITORA", origem: "ROL", colunaOrigem: "EDITORA" },
            { nomeFinal: "PORCENTAGEM DA EDITORA", origem: "FIXO", colunaOrigem: "30%" },
            { nomeFinal: "CNPJ DA EDITORA", origem: "TITULAR", colunaOrigem: "CPF" },
            { nomeFinal: "DATA DE PUBLICAÇÃO", origem: "ROL", colunaOrigem: "DATA DE DISPONIBILIZAÇÃO" },
            { nomeFinal: "DATA DE GRAVAÇÃO", origem: "ROL", colunaOrigem: "DATA DE DISPONIBILIZAÇÃO" },
            { nomeFinal: "ISRC", origem: "ROL", colunaOrigem: "ISRC" },
            { nomeFinal: "VERSÃO", origem: "FIXO", colunaOrigem: "TRILHA" }, ,
            { nomeFinal: "PACOTE", origem: "ROL", colunaOrigem: "REFERENCIA" },
            { nomeFinal: "PAIS DE ORIGEM", origem: "FIXO", colunaOrigem: "BR" },
            { nomeFinal: "PAIS DE PUBLICAÇÃO", origem: "FIXO", colunaOrigem: "BR" },
            { nomeFinal: "DURAÇÃO", origem: "ROL", colunaOrigem: "DUR" },
            { nomeFinal: "ARRANJO", origem: "FIXO", colunaOrigem: "OUTROS" },
            { nomeFinal: "COMPLEMENTO DO ARRANJO", origem: "ROL", colunaOrigem: "GENERO_VERSAO" }, // Gênero e Versão concatenados
            { nomeFinal: "NOME COMPLETO DOS INTERPRETES", origem: "ROL", colunaOrigem: "INTERPRETE" },
            { nomeFinal: "PSEUDONIMO", origem: "ROL", colunaOrigem: "INTERPRETE" },
            { nomeFinal: "CPF DOS INTERPRETES", origem: "ROL", colunaOrigem: "INTERPRETE" },
            { nomeFinal: "INSTRUMENTOS", origem: "FICHA", colunaOrigem: "INSTRUMENTO" },
            { nomeFinal: "NOME COMPLETO DOS MUSICOS ACOMPANHANTES", origem: "FICHA", colunaOrigem: "MUSICO ACOMPANHANTE" },
            { nomeFinal: "CPF DOS MUSICOS ACOMPANHANTES", origem: "FICHA", colunaOrigem: "MUSICO ACOMPANHANTE" },
            { nomeFinal: "NOME DA PRODUTORA", origem: "FIXO", colunaOrigem: "MJC MUSIC" },
            { nomeFinal: "CNPJ DA PRODUTORA", origem: "FIXO", colunaOrigem: "MJC MUSIC" }, // Será buscado no BD Titular
            { nomeFinal: "PERCENTUAL DOS INTERPRETES", origem: "FIXO", colunaOrigem: "" } // Ficará em branco
          ],
          basico: [
            { nomeFinal: "TITULO", origem: "ROL", colunaOrigem: "TITULO" },
            { nomeFinal: "AUTORES", origem: "ROL", colunaOrigem: "AUTOR" },
            { nomeFinal: "DURACAO", origem: "ROL", colunaOrigem: "DURACAO" },
            { nomeFinal: "INTERPRETES", origem: "ROL", colunaOrigem: "INTERPRETE" }
          ]
        };

        this.resultado = null;
        this.initEventListeners();
        this.carregarPreset('ecad'); // Carrega o preset ECAD por padrão
      }

      initEventListeners() {
        // Event listeners para os inputs de arquivo
        document.getElementById('rolObras').addEventListener('change', (e) => this.handleFileSelect(e, 'rolObras'));
        document.getElementById('fichaTecnica').addEventListener('change', (e) => this.handleFileSelect(e, 'fichaTecnica'));
        document.getElementById('dadosTitular').addEventListener('change', (e) => this.handleFileSelect(e, 'dadosTitular'));
      }

      async handleFileSelect(event, tipo) {
        const file = event.target.files[0];
        if (!file) return;

        // Atualiza o nome do arquivo exibido
        document.getElementById(`${tipo}FileName`).textContent = file.name;

        try {
          // Processa o arquivo conforme o tipo
          this.dados[tipo] = await this.lerArquivo(file);
          console.log(`${tipo} carregado:`, this.dados[tipo]);
        } catch (error) {
          console.error(`Erro ao processar ${tipo}:`, error);
          alert(`Erro ao processar o arquivo ${file.name}: ${error.message}`);
        }
      }

      async lerArquivo(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
              const jsonData = XLSX.utils.sheet_to_json(firstSheet, { raw: false, defval: null }); // raw: false para formatar datas
              resolve(jsonData);
            } catch (error) {
              reject(error);
            }
          };
          reader.onerror = reject;
          reader.readAsArrayBuffer(file);
        });
      }

      adicionarCampo(nomeFinal = '', origem = 'ROL', colunaOrigem = '') {
        const container = document.getElementById('mapeamentoCampos');
        const div = document.createElement('div');
        div.className = 'grid grid-cols-12 gap-2 mb-2';

        div.innerHTML = `
          <div class="col-span-5">
            <input type="text" value="${nomeFinal}" placeholder="Nome na planilha final" 
                   class="w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
          </div>
          <div class="col-span-4">
            <select class="w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
              <option value="ROL" ${origem === 'ROL' ? 'selected' : ''}>Rol de Obras</option>
              <option value="FICHA" ${origem === 'FICHA' ? 'selected' : ''}>Ficha Técnica</option>
              <option value="TITULAR" ${origem === 'TITULAR' ? 'selected' : ''}>Dados do Titular</option>
              <option value="FIXO" ${origem === 'FIXO' ? 'selected' : ''}>Valor Fixo</option>
            </select>
          </div>
          <div class="col-span-2">
            <input type="text" value="${colunaOrigem}" placeholder="Coluna origem" 
                   class="w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
          </div>
          <div class="col-span-1">
            <button onclick="this.parentElement.parentElement.remove()" 
                    class="w-full px-3 py-2 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 rounded hover:bg-red-200 dark:hover:bg-red-800">
              <svg class="w-4 h-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        `;

        container.appendChild(div);
      }

      carregarPreset(tipo) {
        const container = document.getElementById('mapeamentoCampos');
        container.innerHTML = '';

        const preset = this.presets[tipo];
        if (preset) {
          preset.forEach(campo => {
            this.adicionarCampo(campo.nomeFinal, campo.origem, campo.colunaOrigem);
          });
        }
      }

      obterMapeamento() {
        const container = document.getElementById('mapeamentoCampos');
        const linhas = container.querySelectorAll('.grid');
        const mapeamento = [];

        linhas.forEach(linha => {
          const inputs = linha.querySelectorAll('input, select');
          if (inputs.length >= 3) {
            const nomeFinal = inputs[0].value.trim();
            const origem = inputs[1].value;
            const colunaOrigem = inputs[2].value.trim();

            if (nomeFinal && colunaOrigem) {
              mapeamento.push({
                nomeFinal,
                origem,
                colunaOrigem
              });
            }
          }
        });

        return mapeamento;
      }

      // Função para buscar CPF no BD Titulares
      buscarCpfPorNome(nome) {
        if (!this.dados.dadosTitular || !nome) return null;
        const titular = this.dados.dadosTitular.find(t =>
          (t.NOME && t.NOME.toLowerCase() === nome.toLowerCase()) ||
          (t.PSEUDONIMO && t.PSEUDONIMO.toLowerCase() === nome.toLowerCase())
        );
        return titular ? titular.CPF : null;
      }

      // Função para buscar Nome Completo no BD Titulares
      buscarNomeCompletoPorPseudonimo(pseudonimo) {
    if (!this.dados.dadosTitular || !pseudonimo) return null;

    const pseudonimoLimpo = pseudonimo.trim().toLowerCase();

    const titular = this.dados.dadosTitular.find(t => {
        const pseudo = (t.PSEUDONIMO || '').trim().toLowerCase();
        return pseudo === pseudonimoLimpo;
    });

    return titular ? titular.NOME || null : null;
}

      // Função para buscar CNPJ no BD Titulares (usando a coluna CPF)
      buscarCnpjPorNome(nome) {
        if (!this.dados.dadosTitular || !nome) return null;
        const titular = this.dados.dadosTitular.find(t =>
          (t.NOME && t.NOME.toLowerCase() === nome.toLowerCase()) ||
          (t.PSEUDONIMO && t.PSEUDONIMO.toLowerCase() === nome.toLowerCase()) ||
          (t.EDITORA && t.EDITORA.toLowerCase() === nome.toLowerCase()) // Adicionado para buscar editora
        );
        return titular ? titular.CPF : null; // Retorna CPF, que é o CNPJ para editoras
      }

      async processarPlanilhas() {
        try {
          // Verificar se todas as planilhas foram carregadas
          if (!this.dados.rolObras || !this.dados.fichaTecnica || !this.dados.dadosTitular) {
            alert('Por favor, carregue todas as três planilhas antes de processar.');
            return;
          }

          // Mostrar loading
          this.mostrarLoading(true);

          // Obter mapeamento
          const mapeamento = this.obterMapeamento();
          if (mapeamento.length === 0) {
            alert('Por favor, configure pelo menos um campo no mapeamento.');
            this.mostrarLoading(false);
            return;
          }

          // Processar dados
          const resultado = [];
          const validacoes = [];

          // Para cada linha do Rol de Obras (assumindo que é a planilha principal)
          this.dados.rolObras.forEach((linhaRol, index) => {
            const novaLinha = {};

            mapeamento.forEach(campo => {
              let valor = null;

              switch (campo.nomeFinal) {
                case 'PORCENTAGEM DOS AUTORES':
                  const participacaoAutoresStr = linhaRol["%"]; // Alterado para '%' conforme feedback
                  if (participacaoAutoresStr) {
                    const percentuais = participacaoAutoresStr.split("-").map(p => parseFloat(p.trim()));
                    if (percentuais.every(p => !isNaN(p))) {
                      const porcentagensComAdmin = percentuais.map(p => (p - (p * 0.30)).toFixed(2)); // Subtrai 30% de administração
                      valor = porcentagensComAdmin.join("-");
                    } else {
                      validacoes.push(`Linha ${index + 1} (Rol de Obras): Formato de porcentagem de autores inválido para "${participacaoAutoresStr}". Esperado X-Y.`);
                    }
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo '%' vazio para porcentagem dos autores.`);
                  }
                  break;

                case 'CPF DOS AUTORES':
                  const autoresStr = linhaRol['AUTOR'];
                  if (autoresStr) {
                    const autores = autoresStr.replace(/\(autores:\s*|\)/g, '').split('-').map(a => a.trim());
                    valor = autores.map(autor => {
                      const cpf = this.buscarCpfPorNome(autor);
                      if (!cpf) {
                        validacoes.push(`Linha ${index + 1} (Rol de Obras): CPF não encontrado para o autor "${autor}".`);
                      }
                      return cpf || 'CPF_NAO_ENCONTRADO';
                    }).join('-');
                  }
                  break;

                case 'CNPJ DA EDITORA':
                  const editoraNome = linhaRol["EDITORA"];
                  if (editoraNome) {
                    const cnpj = this.buscarCnpjPorNome(editoraNome); // Usar buscarCnpjPorNome para CNPJ
                    if (!cnpj) {
                      validacoes.push(`Linha ${index + 1} (Rol de Obras): CNPJ não encontrado para a editora "${editoraNome}".`);
                    }
                    valor = cnpj || 'CNPJ_NAO_ENCONTRADO';
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo 'EDITORA' vazio para CNPJ da editora.`);
                  }
                  break;

                case 'DATA DE PUBLICAÇÃO':
                case 'DATA DE GRAVAÇÃO':
                  const dataDisponibilizacao = linhaRol["DATA DE DISPONIBILIZAÇÃO"];
                  if (dataDisponibilizacao) {
                    // Tenta converter de número de série do Excel para data formatada
                    if (typeof dataDisponibilizacao === 'number') {
                      // Converte número de série do Excel para data
                      const date = new Date(Math.round((dataDisponibilizacao - 25569) * 86400 * 1000));
                      valor = `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;
                    } else if (dataDisponibilizacao instanceof Date) {
                      valor = dataDisponibilizacao.toLocaleDateString('pt-BR');
                    } else {
                      valor = dataDisponibilizacao; // Assume que já está no formato correto ou string
                    }
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo 'DATA DE DISPONIBILIZAÇÃO' vazio para data de publicação/gravação.`);
                  }
                  break;

                case 'DURAÇÃO':
                  const duracaoStr = linhaRol['DUR'];
                  if (duracaoStr) {
                    if (typeof duracaoStr === 'number' && duracaoStr < 1) { // Assume que é um número serial do Excel para tempo
                      const totalSeconds = Math.round(duracaoStr * 24 * 60 * 60);
                      const hours = Math.floor(totalSeconds / 3600);
                      const minutes = Math.floor((totalSeconds % 3600) / 60);
                      const seconds = totalSeconds % 60;
                      valor = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                    } else {
                      const parts = String(duracaoStr).split(':');
                      if (parts.length === 2) {
                        const minutes = parseInt(parts[0]);
                        const seconds = parseInt(parts[1]);
                        valor = `00:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                      } else {
                        validacoes.push(`Linha ${index + 1} (Rol de Obras): Formato de duração inválido para "${duracaoStr}". Esperado MM:SS ou número serial do Excel.`);
                      }
                    }
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo 'DUR' vazio para duração.`);
                  }
                  break;

                case 'COMPLEMENTO DO ARRANJO':
                  const genero = linhaRol['GENERO'];
                  const versao = linhaRol['VERSAO'];
                  if (genero && versao) {
                    valor = `${genero}-${versao}`;
                  } else if (genero) {
                    valor = genero;
                  } else if (versao) {
                    valor = versao;
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campos 'GENERO' e 'VERSAO' vazios para complemento do arranjo.`);
                  }
                  break;

                case 'NOME COMPLETO DOS INTERPRETES':
                  const interpretesStr = linhaRol['INTERPRETE'];
                  if (interpretesStr) {
                    // Divide considerando possíveis espaços antes/depois do hífen
                    const interpretes = interpretesStr.split(/\s*-\s*/).map(i => i.trim());
                    valor = interpretes.map(interprete => {
                      const nomeCompleto = this.buscarNomeCompletoPorPseudonimo(interprete);
                      if (!nomeCompleto) {
                        validacoes.push(`Linha ${index + 1} (Rol de Obras): Nome completo não encontrado para o intérprete "${interprete}".`);
                      }
                      return nomeCompleto || '';
                    }).join(' - '); // Junta com hífen, já que é o formato que você quer ver na planilha
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo 'INTERPRETE' vazio para nome completo dos intérpretes.`);
                  }
                  break;

                case 'CPF DOS INTERPRETES':
                  const interpretesCpfStr = linhaRol['INTERPRETE'];
                  if (interpretesCpfStr) {
                    const interpretesCpf = interpretesCpfStr.split('-').map(i => i.trim());
                    valor = interpretesCpf.map(interprete => {
                      const cpf = this.buscarCpfPorNome(interprete);
                      if (!cpf) {
                        validacoes.push(`Linha ${index + 1} (Rol de Obras): CPF não encontrado para o intérprete "${interprete}".`);
                      }
                      return cpf || ''; // Retorna string vazia em vez de 'CPF_NAO_ENCONTRADO'
                    }).join('-');
                  } else {
                    validacoes.push(`Linha ${index + 1} (Rol de Obras): Campo 'INTERPRETE' vazio para CPF dos intérpretes.`);
                  }
                  break;

                case 'NOME COMPLETO DOS MUSICOS ACOMPANHANTES':
                  const musicosAcompanhantesFicha = this.dados.fichaTecnica.find(f =>
                    f.TITULO && linhaRol.TITULO &&
                    f.TITULO.toLowerCase() === linhaRol.TITULO.toLowerCase()
                  );
                  if (musicosAcompanhantesFicha && musicosAcompanhantesFicha['MUSICO ACOMPANHANTE']) {
                    const musicosStr = musicosAcompanhantesFicha['MUSICO ACOMPANHANTE'];
                    const regex = /(?:\(|^)([^:]+):\s*([^)]+)(?:\)|$)/g;
                    let match;
                    const nomes = [];
                    while ((match = regex.exec(musicosStr)) !== null) {
                      nomes.push(match[2].trim());
                    }
                    valor = nomes.join('-');
                  } else {
                    validacoes.push(`Linha ${index + 1} (Ficha Técnica): Músicos acompanhantes não encontrados ou campo vazio.`);
                  }
                  break;

                case 'CPF DOS MUSICOS ACOMPANHANTES':
                  const musicosCpfFicha = this.dados.fichaTecnica.find(f =>
                    f.TITULO && linhaRol.TITULO &&
                    f.TITULO.toLowerCase() === linhaRol.TITULO.toLowerCase()
                  );
                  if (musicosCpfFicha && musicosCpfFicha['MUSICO ACOMPANHANTE']) {
                    const musicosStr = musicosCpfFicha['MUSICO ACOMPANHANTE'];
                    const regex = /(?:\(|^)([^:]+):\s*([^)]+)(?:\)|$)/g;
                    let match;
                    const cpfs = [];
                    while ((match = regex.exec(musicosStr)) !== null) {
                      const nomeMusico = match[2].trim();
                      const cpf = this.buscarCpfPorNome(nomeMusico);
                      if (!cpf) {
                        validacoes.push(`Linha ${index + 1} (Ficha Técnica): CPF não encontrado para o músico acompanhante "${nomeMusico}".`);
                      }
                      cpfs.push(cpf || '');
                    }
                    valor = cpfs.join('-');
                  } else {
                    validacoes.push(`Linha ${index + 1} (Ficha Técnica): Músicos acompanhantes não encontrados ou campo vazio para CPF.`);
                  }
                  break;

                case 'CNPJ DA PRODUTORA':
                  const produtoraNome = 'MJC MUSIC'; // Nome fixo da produtora
                  if (produtoraNome) {
                    const cnpjProdutora = this.buscarCpfPorNome(produtoraNome); // Usar buscarCpfPorNome para CNPJ
                    if (!cnpjProdutora) {
                      validacoes.push(`Linha ${index + 1}: CNPJ não encontrado para a produtora "${produtoraNome}".`);
                    }
                    valor = cnpjProdutora || '';
                  }
                  break;

                default:
                  switch (campo.origem) {
                    case 'ROL':
                      valor = linhaRol[campo.colunaOrigem];
                      break;
                    case 'FICHA':
                      const linhaFicha = this.dados.fichaTecnica.find(f =>
                        f.TITULO && linhaRol.TITULO &&
                        f.TITULO.trim().toLowerCase() === linhaRol.TITULO.trim().toLowerCase()
                      );
                      valor = linhaFicha ? linhaFicha[campo.colunaOrigem] : null;
                      break;
                    case 'FIXO':
                      valor = campo.colunaOrigem;
                      break;
                  }
              }

              novaLinha[campo.nomeFinal] = valor || '';
            });

            resultado.push(novaLinha);
          });

          this.resultado = resultado;
          this.mostrarResultado(resultado, validacoes);
          this.mostrarLoading(false);

        } catch (error) {
          console.error('Erro ao processar planilhas:', error);
          alert(`Erro ao processar planilhas: ${error.message}`);
          this.mostrarLoading(false);
        }
      }

      mostrarLoading(mostrar) {
        const btn = document.getElementById('processarBtn');
        const icon = document.getElementById('processarIcon');
        const text = document.getElementById('processarText');
        const loading = document.getElementById('loadingIcon');

        if (mostrar) {
          btn.disabled = true;
          icon.classList.add('hidden');
          loading.classList.remove('hidden');
          text.textContent = 'Processando...';
        } else {
          btn.disabled = false;
          icon.classList.remove('hidden');
          loading.classList.add('hidden');
          text.textContent = 'Processar Planilhas';
        }
      }

      mostrarResultado(dados, validacoes) {
        const container = document.getElementById('resultadoContainer');
        const preview = document.getElementById('resultadoPreview');
        const validacaoContainer = document.getElementById('validacaoContainer');
        const validacaoLista = document.getElementById('validacaoLista');

        // Mostrar container
        container.classList.remove('hidden');

        // Gerar preview da tabela
        if (dados.length > 0) {
          const colunas = Object.keys(dados[0]);
          let html = '<table class="w-full border-collapse border border-gray-300 dark:border-gray-600">';

          // Cabeçalho
          html += '<thead><tr class="bg-gray-100 dark:bg-gray-700">';
          colunas.forEach(col => {
            html += `<th class="border border-gray-300 dark:border-gray-600 px-2 py-1 text-left">${col}</th>`;
          });
          html += '</tr></thead>';

          // Dados (primeiras 5 linhas)
          html += '<tbody>';
          dados.slice(0, 5).forEach(linha => {
            html += '<tr>';
            colunas.forEach(col => {
              html += `<td class="border border-gray-300 dark:border-gray-600 px-2 py-1">${linha[col] || ''}</td>`;
            });
            html += '</tr>';
          });
          html += '</tbody></table>';

          if (dados.length > 5) {
            html += `<p class="mt-2 text-gray-500">... e mais ${dados.length - 5} linhas</p>`;
          }

          preview.innerHTML = html;
        }

        // Mostrar validações
        if (validacoes.length > 0) {
          validacaoContainer.classList.remove('hidden');
          validacaoLista.innerHTML = validacoes.map(v => `<div>• ${v}</div>`).join('');
        } else {
          validacaoContainer.classList.add('hidden');
        }
      }

      downloadPlanilha() {
        if (!this.resultado) {
          alert('Nenhuma planilha processada para download.');
          return;
        }

        try {
          // Criar workbook
          const ws = XLSX.utils.json_to_sheet(this.resultado);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Consolidado");

          // Download
          const fileName = `planilha_consolidada_${new Date().toISOString().split('T')[0]}.xlsx`;
          XLSX.writeFile(wb, fileName);
        } catch (error) {
          console.error('Erro ao gerar download:', error);
          alert(`Erro ao gerar download: ${error.message}`);
        }
      }

      exportarConfiguracao() {
        const mapeamento = this.obterMapeamento();
        const config = {
          mapeamento,
          configuracoes: {
            colunaId: document.getElementById('colunaId').value,
            separadorValores: document.getElementById('separadorValores').value,
            validarPseudonimo: document.getElementById('validarPseudonimo').checked,
            validarCamposObrigatorios: document.getElementById('validarCamposObrigatorios').checked,
            validarRelacionamentos: document.getElementById('validarRelacionamentos').checked
          }
        };

        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'configuracao_consolidador.json';
        a.click();
        URL.revokeObjectURL(url);
      }

      importarConfiguracao(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const config = JSON.parse(e.target.result);

            // Limpar mapeamento atual
            document.getElementById('mapeamentoCampos').innerHTML = '';

            // Carregar mapeamento
            if (config.mapeamento) {
              config.mapeamento.forEach(campo => {
                this.adicionarCampo(campo.nomeFinal, campo.origem, campo.colunaOrigem);
              });
            }

            // Carregar configurações
            if (config.configuracoes) {
              const conf = config.configuracoes;
              if (conf.colunaId) document.getElementById('colunaId').value = conf.colunaId;
              if (conf.separadorValores) document.getElementById('separadorValores').value = conf.separadorValores;
              if (typeof conf.validarPseudonimo === 'boolean') document.getElementById('validarPseudonimo').checked = conf.validarPseudonimo;
              if (typeof conf.validarCamposObrigatorios === 'boolean') document.getElementById('validarCamposObrigatorios').checked = conf.validarCamposObrigatorios;
              if (typeof conf.validarRelacionamentos === 'boolean') document.getElementById('validarRelacionamentos').checked = conf.validarRelacionamentos;
            }

            alert('Configuração importada com sucesso!');
          } catch (error) {
            console.error('Erro ao importar configuração:', error);
            alert('Erro ao importar configuração. Verifique se o arquivo é válido.');
          }
        };
        reader.readAsText(file);
      }
    }

    // Inicializar aplicação
    const app = new ConsolidadorMusical();
  </script>
</body>

</html>

